{"version":3,"sources":["plugins/client-server-base.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAoBgB,YAAY,GAAZ,YAAY,qBAnBH,SAAS,EADlC,IAAI,CAAC,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC,AAGnB,IAAM,OAAO,GAAG,GAAG,EAAE,MAAM,GAAG,GAAG,CAAC,QAA5B,OAAO,GAAP,OAAO,SAAQ,MAAM,GAAN,MAAM,CAC3B,IAAM,gBAAgB,GAAG,EAC9B,KAAK,EAAA,eAAC,KAAK,EAAE;AAEX,QAAI,QAAQ,GAAG,CAAC,CAAC,IAAI,CAAC,KAAK,QANtB,QAAQ,CAMyB,CAAC,AACvC,IAAI,KAAK,GAAG,CAAC,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC,CAAC,MAAM,OAP7B,QAAQ,CAO+B,CAAC,CAAC;AAG9C,QAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;AAGnB,KAAC,CAAC,IAAI,CAAC,QAAQ,EAAE,UAAC,KAAK,EAAE,EAAE,EAAK,CAC9B,MAAK,GAAG,CAAC,EAAE,EAAE,KAAK,CAAC,CAAC,CACrB,CAAC,CAAC,CACJ,EACF,CAAC,QAdW,gBAAgB,GAAhB,gBAAgB,CAgBtB,SAAS,YAAY,CAAC,SAAS,EAAE,QAAQ,EAAE;AAEhD,MAAI,OAAO,YAAA,CAAC,AACZ,IAAI,CACF,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;AAChC,QAAI,KAAK,GAAG,YAAY,CAAC,OAAO,CAAC,CAAC;AAClC,QAAI,CAAC,KAAK;AACR,UAAM,IAAI,KAAK,CAAC,2BAA2B,CAAC,CAAC,CAChD;AAAC,SAAM,CAAC,EAAE;AACT,WAAO,CAAC,KAAK,kCAA+B,SAAS,SAAK,CAAC;AAC3D,WAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;AACjB,WAAO,CACR;;;;AAGD,MAAI;AACF,YAAQ,CAAC,OAAO,CAAC,CAAC,CACnB;AAAC,SAAM,CAAC,EAAE;AACT,WAAO,CAAC,KAAK,kDAA+C,SAAS,SAAK,CAAC;AAC3E,WAAO,CAAC,KAAK,CAAC,CAAC,CAAC,KAAK,IAAI,CAAC,CAAC,CAAC,CAC7B,CACF;;;;AAED,SAAS,YAAY,CAAC,OAAO,EAAE;AAC7B,MAAI,EAAE,OAAO,YAAY,KAAK,CAAA,AAAC,EAAE,OAAO,KAAK,CAAC;AAC9C,MAAI,OAAO,CAAC,MAAM,IAAI,CAAC,EAAE,OAAO,KAAK,CAAC;;AAEzB,SAAO,SAAf,IAAI;AACT,MAAI,IAAI,IAAI,OAAO,IAAI,IAAI,IAAI,MAAM;AACnC,SAAO,KAAK,CAAC;;AAEf,SAAO,IAAI,CAAC,CACb","file":"plugins/client-server-base.js","sourcesContent":["let _ = require('lodash');\r\nimport { isObject } from '../util';\r\n\r\nexport const COMMAND = 'c', INTENT = 'i';\r\nexport const BUILTIN_COMMANDS = {\r\n  _seed(state) {\r\n    // we have to do this through .update() and .add() to trigger events properly\r\n    let children = _.pick(state, isObject);\r\n    let props = _.pick(state, _.negate(isObject));\r\n\r\n    // set all properties\r\n    this.update(props);\r\n\r\n    // add all children\r\n    _.each(children, (child, id) => {\r\n      this.add(id, child);\r\n    });\r\n  }\r\n};\r\n\r\nexport function parseMessage(msgString, callback) {\r\n  // parse the message\r\n  let message;\r\n  try {\r\n    message = JSON.parse(msgString);\r\n    let valid = messageValid(message);\r\n    if (!valid)\r\n      throw new Error('Incorrect message format.');\r\n  } catch(e) {\r\n    console.error(`Received garbage message: '${msgString}'.`);\r\n    console.error(e);\r\n    return;\r\n  }\r\n\r\n  // try to act upon it\r\n  try {\r\n    callback(message);\r\n  } catch(e) {\r\n    console.error(`Problem encountered when handling message '${msgString}':`);\r\n    console.error(e.stack || e);\r\n  }\r\n}\r\n\r\nfunction messageValid(message) {\r\n  if (!(message instanceof Array)) return false;\r\n  if (message.length != 4) return false;\r\n\r\n  let [code] = message;\r\n  if (code != COMMAND && code != INTENT)\r\n    return false;\r\n\r\n  return true;\r\n}\r\n"],"sourceRoot":"..\\..\\..\\lib"}