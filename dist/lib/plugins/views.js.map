{"version":3,"sources":["plugins/views.js"],"names":[],"mappings":"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","file":"plugins/views.js","sourcesContent":["let _ = require('lodash');\n\nimport { functionized } from '../util';\nimport { Queue } from '../task-queues';\n\nexport default function views(options) {\n  return functionized(ViewsPlugin, [options], 'applyPlugin');\n}\n\nfunction ViewsPlugin() {\n  this.animationQueue = new Queue();\n  this.registeredViews = {};\n}\nViewsPlugin.prototype = {\n  applyPlugin(u) {\n    this.u = u;\n    return {\n      name: 'views',\n      methods: {\n        animation: this.animation.bind(this)\n      },\n      nodeMethods: {\n        watch: watch,\n\n        registerView: registerView,\n        view: view\n      }\n    }\n  },\n\n  animation(fn) {\n    let synced = this.animationQueue.synchronize(fn);\n    synced._animation = true;\n    return synced;\n  }\n};\n\nfunction watch(object, events) {\n  // 'this' here will refer to the node .watch() was called on\n\n  let boundListeners = [];\n  let node = this;\n\n  // apply all the requested listeners\n  _.each(events, (method, event) => {\n    let listener = method.bind(object);\n\n    if (!listener._animation)\n      listener = this.u.animation(listener);\n\n    node.on(event, listener);\n    boundListeners.push({event: event, listener: listener});\n  });\n\n  // when the node we are watching gets destroyed, we want to unbind all those listeners\n  // (including the listener that keeps track of it)\n  let unbindListener = () => {\n    _.each(boundListeners, ({event, listener}) => {\n      node.off(event, listener);\n    });\n  };\n  node.on('destroyed', unbindListener);\n  boundListeners.push({event: 'destroyed', listener: unbindListener});\n}\n\nfunction registerView(viewObject) {\n  let views = this.u.plugins.views, path = this.path();\n  views.registeredViews[path] = viewObject;\n  this.on('destroyed', () => {\n    delete views.registeredViews[path];\n  });\n}\n\nfunction view() {\n  return this.u.plugins.views.registeredViews[this.path()];\n}\n"],"sourceRoot":"../../../lib"}