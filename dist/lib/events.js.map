{"version":3,"sources":["events.js"],"names":[],"mappings":"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","file":"events.js","sourcesContent":["let _ = require('lodash');\n\nimport {childPath, parentPath} from './util';\n\nexport default class UnisonEvents {\n  constructor() {\n    this._listeners = {};\n  }\n\n  key(path, event) {\n    return `${path}:${event}`;\n  }\n\n  listen(path, event, callback) {\n    let key = this.key(path, event);\n    let existingListeners = this._listeners[key] || [];\n    this._listeners[key] = existingListeners.concat([callback]);\n  }\n\n  unlisten(path, event, callback) {\n    let key = this.key(path, event);\n    let listeners  = (this._listeners[key] || []).filter((cb) => cb != callback);\n    if (listeners.length == 0) {\n      delete this._listeners[key];\n    } else {\n      this._listeners[key] = listeners;\n    }\n  }\n\n  handle(path, event, payload) {\n    let key = this.key(path, event);\n    let listeners = this._listeners[key];\n    if (listeners) {\n      listeners.map((l) => {\n        try {\n          l(payload);\n        } catch (e) {\n          console.error(`Error in listener in response to ${path}|${event}`);\n          console.error(e.stack || e);\n        }\n      });\n    }\n  }\n\n  trigger(path, event, payload) {\n    let paths;\n    if (path != '') {\n      paths = [path, childPath(parentPath(path), '*')]; // X.Y.Z, X.Y.*\n\n      path = childPath(parentPath(path), '**'); // X.Y.Z -> X.Y.**\n      paths.push(path);\n      while(path.indexOf('.') >= 0) {\n        path = childPath(parentPath(parentPath(path)), '**'); // X.Y.** -> X.**\n        paths.push(path);\n      }\n    } else {\n      paths = ['', '**'];\n    }\n\n    paths.forEach((path) => {\n      this.handle(path, event, payload);\n    });\n  }\n\n  triggerAll(events) {\n    _.each(events, (event) => {\n      this.trigger.apply(this, event);\n    });\n  }\n}"],"sourceRoot":"../../lib"}