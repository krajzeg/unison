{"version":3,"sources":["events.js"],"names":[],"mappings":"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","file":"events.js","sourcesContent":["let _ = require('lodash');\n\nimport {childPath, parentPath} from './util';\n\nexport default class UnisonEvents {\n  constructor(unison) {\n    this.u = unison\n    this._listeners = {};\n  }\n\n  key(path, event) {\n    return `${path}:${event}`;\n  }\n\n  listen(path, event, callback) {\n    let key = this.key(path, event);\n    let existingListeners = this._listeners[key] || [];\n    this._listeners[key] = existingListeners.concat([callback]);\n  }\n\n  unlisten(path, event, callback) {\n    let key = this.key(path, event);\n    let listeners  = (this._listeners[key] || []).filter((cb) => cb != callback);\n    if (listeners.length == 0) {\n      delete this._listeners[key];\n    } else {\n      this._listeners[key] = listeners;\n    }\n  }\n\n  handle(path, eventObj) {\n    let key = this.key(path, eventObj.name);\n    let listeners = this._listeners[key];\n    if (listeners) {\n      listeners.map((l) => {\n        try {\n          l(eventObj);\n        } catch (e) {\n          console.error(`Error in listener in response to ${path}|${event}`);\n          console.error(e.stack || e);\n        }\n      });\n    }\n  }\n\n  trigger(path, event, payload = {}) {\n    let source = (this.u)(path);\n    let eventObj = new UnisonEvent(event, source, payload);\n\n    let paths;\n    if (path != '') {\n      paths = [path, childPath(parentPath(path), '*')]; // X.Y.Z, X.Y.*\n\n      path = childPath(path, '**'); // X.Y.Z -> X.Y.Z.**\n      paths.push(path);\n      while(path.indexOf('.') >= 0) {\n        path = childPath(parentPath(parentPath(path)), '**'); // X.Y.** -> X.**\n        paths.push(path);\n      }\n    } else {\n      paths = ['', '**'];\n    }\n\n    paths.forEach((path) => {\n      if (!eventObj._handled)\n        this.handle(path, eventObj);\n    });\n  }\n\n  triggerAll(events) {\n    _.each(events, (event) => {\n      this.trigger.apply(this, event);\n    });\n  }\n}\n\n// Represents all events triggered from Unison and their common properties.\nclass UnisonEvent {\n  constructor(name, source, additionalProps = {}) {\n    this.name = name;\n    this.source = source;\n    this._handled = false;\n\n    _.extend(this, additionalProps);\n  }\n\n  stopBubbling() {\n    this._handled = true;\n  }\n}\n"],"sourceRoot":"../../lib"}