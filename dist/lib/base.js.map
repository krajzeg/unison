{"version":3,"sources":["base.js"],"names":[],"mappings":"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","file":"base.js","sourcesContent":["let _ = require('lodash');\n\n\nexport default class Unison {\n  constructor(initialState = {}) {\n   this._state = initialState;\n   this._nextId = 1;\n  }\n\n  grab(path) {\n    return new UnisonNode(this, path)\n  }\n\n  trigger(path, event) {\n    // nothing for now\n  }\n\n  nextId() {\n    return this._nextId++;\n  }\n\n}\n\nclass UnisonNode {\n  constructor(unison, path) {\n    this._unison = unison;\n    this._path = path;\n  }\n\n  path() {\n    return this._path;\n  }\n\n  id() {\n    let path = this.path();\n    if (path === '') {\n      throw new Error('The root object has no id.');\n    } else {\n      return _.last(path.split(\".\"));\n    }\n  }\n\n  parent() {\n    let path = this.path();\n    if (path === '') {\n      throw new Error('The root object has no parent.');\n    } else {\n      let pathElements = path.split(\".\");\n      pathElements.pop();\n      let parentPath = pathElements.join(\".\");\n\n      return this._unison.grab(parentPath);\n    }\n  }\n\n  state() {\n    if (this._path === '') {\n      return this._unison._state;\n    } else {\n      return _.get(this._unison._state, this._path);\n    }\n  }\n\n  update(props) {\n    var state = this.state();\n    if (state === undefined) return;\n\n    _.extend(state, props);\n    this._unison.trigger(this._path, 'updated');\n  }\n\n  add(...args) {\n    // extract arguments (either (child) or (id, child))\n    let id, child;\n    if (args.length == 2) {\n      [id, child] = args;\n    } else {\n      child = args[0];\n      id = this._unison.nextId();\n    }\n\n    // sanity checks\n    let state = this.state();\n    expectObject(state, `Can't add child at ${this._path}`);\n    if (state[id] !== undefined) {\n      throw new Error(`Can't add child '${id}' at ${this._path} - it already exists.`);\n    }\n\n    // add it\n    state[id] = child;\n\n    // trigger events\n    let childPath = [this._path, id].join(\".\");\n    this._unison.trigger(this._path, 'childAdded', id);\n    this._unison.trigger(childPath, 'created');\n\n    // return the path to the newly created child\n    return childPath;\n  }\n\n  remove(id) {\n    let state = this.state();\n\n    // sanity checks\n    expectObject(state, `Can't remove child at ${this._path}`);\n\n    // does it even exist?\n    if (state[id] === undefined) {\n      return false;\n    }\n\n    // it does, let's remove it\n    delete state[id];\n\n    // trigger events\n    let childPath = [this._path, id].join(\".\");\n    this._unison.trigger(this._path, 'childRemoved', id);\n    this._unison.trigger(childPath, 'destroyed');\n\n    // done\n    return true;\n  }\n\n  destroy() {\n    // straightforward translation\n    expectObject(this.state(), \"Can't destroy ${this._path}\");\n    return this.parent().remove(this.id());\n  }\n}\n\nfunction expectObject(state, msg) {\n  if (state === undefined) {\n    throw new Error(`${msg} - node does not exist.`)\n  }\n  if (typeof state != 'object') {\n    throw new Error(`${msg} - '${state}' is not an object.`);\n  }\n}\n"],"sourceRoot":"../../lib"}